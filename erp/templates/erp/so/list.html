{% extends "erp/common/base.html" %}

{% block page-header %}
	Sales Order
	<a href="{% url 'so_add' %}" class="btn btn-xs addlink">
		<i class="fa fa-plus"></i>
		Add
	</a>
{% endblock %}


{% block content %}
	{% include "erp/common/filter.html" %}

	<table class="table table-striped table-hover">
	<thead>
		<tr>
		<th rowspan="2"></th>
		<th rowspan="2">SALES TYPE</th>
		<th rowspan="2">CODE</th>
		<th rowspan="2">CUSTOMER</th>
		<th rowspan="2">SALES</th>
		<th colspan="3">ORDER SUMMARY</th>
		<th colspan="4">FULLFILLMENTS</th>
		<th colspan="2">PAYMENTS</th>
		</tr>

		<tr>
			{# order details #}
			<th>QTY</th>
			<th>ORDER VALUE</th>
			<th>DISCOUNT</th>

			{# fullfillment #}
			<th>QTY</th>
			<th>VALUE</th>
			<th>RATE BY QTY</th>
			<th>RATE BY VALUE</th>

			{# payment #}
			<th>PAID</th>
			<th>BALANCE</th>
		<tr>
	</thead>
	<tbody>
		{% for obj in object_list %}
		<tr><td>
			<a href="{% url 'so_detail' obj.id %}">Detail</a>

			{# fullfill shortcut #}
			{% if obj.fullfill_rate_by_qty < 100 %}
			| <a href="{% url 'so_fullfill_add' obj.id %}">Fullfill</a>
			{% endif %}

			{# cancel order shortcut #}
			{% if obj.is_editable %}
			| <a data-toggle="modal" data-target="#so-delete-{{obj.id}}">Cancel</a>
			{% endif %}

		</td><td>
			{{ obj.business_model }}
		</td><td>
			{{ obj.code }}
			{% if obj.is_sold_at_cost %}
				<i class='fa fa-flag-o'></i>
			{% endif %}

			{% if not obj.is_editable %}
				<i class="fa fa-lock"></i>
			{% endif %}			
		</td><td>
			{{ obj.customer }}
		</td><td>
			{{ obj.sales }}
		</td><td>
			{{ obj.total_qty}}
		</td><td>
			{{ obj.total_discount_value|floatformat:2 }}
		</td><td>
			{{ obj.discount }}
		</td><td>
			{{ obj.fullfill_qty }}
		</td><td>
			{{ obj.fullfill_std_value }}
		</td><td>
			{{ obj.fullfill_rate_by_qty|floatformat:0 }}%
		</td><td>
			{{ obj.fullfill_rate_by_value|floatformat:0 }}%
		</td><td>
			{{ obj.total_payment }}
		</td><td>
			{{ obj.account_receivable }}
		</td></tr>
    	{% endfor %}
	</tbody>
	</table>
{% endblock %}

{% block modal %}

{% for object in object_list %}
	{# Delete SO modal #}
	<div id="so-delete-{{object.id}}" class="modal fade" role="dialog">
	<div class="modal-dialog">
	<form action="{% url 'so_delete' object.id %}" method="POST">
	 
	    <!-- Modal content-->
	    <div class="modal-content">

	    	{# Modal header #}
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal">&times;</button>
	        <h4 class="modal-title">To Cancel {{ object.code }}</h4>
	      </div>

	      {# Modal body #}
	      <div class="modal-body alert alert-warning">	
				{% csrf_token %}
				<p>Order cancellation is not recoverable.</p>

				<p>
				Are you sure to cancel this order?
				</p>
	      </div>

	      {# Modal footer #}
	      <div class="modal-footer">
			<button class="btn btn-primary" type="submit">
				<i class="fa fa-check">Yes</i>
			</button>      
	        <button type="button" class="btn btn-default" data-dismiss="modal">
	        	<i class="fa fa-close">No</i>
	        </button>
	      </div>
	    </div>
	</form>          
	</div>
	</div>
{% endfor %}
{% endblock %}

