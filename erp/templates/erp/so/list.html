{% extends "erp/common/base.html" %}

{% block page-header %}
	Sales Order
	<a href="{% url 'so_add' %}" class="btn btn-xs addlink">
		<i class="fa fa-plus"></i>
		Add
	</a>
{% endblock %}


{% block content %}
	{% include "erp/common/filter.html" %}

	<table class="table table-striped table-hover">
	<thead>
		<tr>
		<th rowspan="2"></th>
		<th rowspan="2">Code</th>
		<th rowspan="2">Customer</th>
		<th rowspan="2">Sales</th>
		<th colspan="5">Order Summary</th>
		<th colspan="4">Fullfillment Summary</th>
		</tr>

		<tr>
			{# order details #}
			<th>Line Item</th>
			<th>QTY</th>
			<th>STD Value</th>
			<th>Discount Value</th>
			<th>Implied Discount</th>

			{# fullfillment #}
			<th>QTY</th>
			<th>Sales Value</th>
			<th>Rate by QTY</th>
			<th>Rate by Value</th>
		<tr>
	</thead>
	<tbody>
		{% for obj in object_list %}
		<tr><td>
			<a href="{% url 'so_detail' obj.id %}">Detail</a> | 

			{% if obj.is_editable %}
				<a data-toggle="modal" data-target="#so-delete-{{obj.id}}">Cancel order</a>
			{% endif %}

		</td><td>
			{% if obj.is_sold_at_cost %}
				<i class='fa fa-flag-o'></i>
			{% endif %}
			{{ obj.code }}
		</td><td>
			{{ obj.customer }}
		</td><td>
			{{ obj.sales }}
		</td><td>
			{{ obj.line_item_qty }}
		</td><td>
			{{ obj.total_qty}}
		</td><td>
			{{ obj.total_std_value|floatformat:0 }}
		</td><td>
			{{ obj.total_discount_value|floatformat:2 }}
		</td><td>
			{{ obj.implied_discount }}
		</td><td>
			{{ obj.fullfill_qty }}
		</td><td>
			{{ obj.fullfill_std_value }}
		</td><td>
			{{ obj.fullfull_rate_by_qty }}
		</td><td>
			{{ obj.fullfill_rate_by_value }}
		</td></tr>
    	{% endfor %}
	</tbody>
	</table>
{% endblock %}

{% block modal %}

{% for object in object_list %}
	{# Delete SO modal #}
	<div id="so-delete-{{object.id}}" class="modal fade" role="dialog">
	<div class="modal-dialog">
	<form action="{% url 'so_delete' object.id %}" method="POST">
	 
	    <!-- Modal content-->
	    <div class="modal-content">

	    	{# Modal header #}
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal">&times;</button>
	        <h4 class="modal-title">To Cancel {{ object.code }}</h4>
	      </div>

	      {# Modal body #}
	      <div class="modal-body alert alert-warning">	
				{% csrf_token %}
				<p>Order cancellation is not recoverable.</p>

				<p>
				Are you sure to cancel this order?
				</p>
	      </div>

	      {# Modal footer #}
	      <div class="modal-footer">
			<button class="btn btn-primary" type="submit">
				<i class="fa fa-check">Yes</i>
			</button>      
	        <button type="button" class="btn btn-default" data-dismiss="modal">
	        	<i class="fa fa-close">No</i>
	        </button>
	      </div>
	    </div>
	</form>          
	</div>
	</div>
{% endfor %}
{% endblock %}

