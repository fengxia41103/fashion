{% extends "erp/common/base.html" %}

% load crispy_forms_tags %}
{% load static %}
{% block page-header %}
	Create a fullfillment for 销售订单: {{ object.code }}
{% endblock %}

{% block content %}

{# order header #}
<div class="panel panel-default">
  	<div class="panel-body">
	<div class="row ">
		<div class="col-md-2"><label>Customer code</label></div>
		<div class="col-md-3 my-sf-display-border">{{ object.customer.code }}</div>
		<div class="col-md-1"></div>
		<div class="col-md-2"><label>Customer name</label></div>
		<div class="col-md-3 my-sf-display-border">{{ object.customer }}</div>
		<div class="col-md-1"></div>		
	</div><div class="row ">
		<div class="col-md-2"><label>Sales Order #</label></div>
		<div class="col-md-3 my-sf-display-border">
			{{ object.code }}
			<span class="pull-right" data-toggle="tooltip" title="View sales order details">
				<a href="{% url 'so_detail' object.id %}">
					<i class='fa fa-external-link'></i>
				</a>
			</span>
		</div>
		<div class="col-md-1"></div>
		<div class="col-md-2"><label>Fullfilled by</label></div>
		<div class="col-md-3 my-sf-display-border">{{ object.default_storage }}</div>
		<div class="col-md-1"></div>		
	</div>
	</div>
</div>

<form action="{% url 'so_fullfill_add' object.id %}" method="POST">
{% csrf_token %}
<table class="table table-striped table-hover my-datatable" id="fullfill">
	<thead>
		<th>INVENTORY SKU</th>
		<th>PRODUCT ID</th>
		<th>BRAND</th>
		<th>STYLE</th>
		<th>COLOR</th>
		<th>PRICE</th>		
		<th>SIZE</th>
		<th>QTY BALANCE</th>
		<th>FULLFILLING QTY</th>
	</thead>

	<tbody>
	{% for line_item in items %}
		{% with line_item.item.item as item %}
		<tr><td>
			{{ line_item.item.code }}
		</td><td>
			{{ line_item.item.item.product_id }}
		</td><td>
			{{ item.brand }}
		</td><td>
			{{ item.name }}
		</td><td>
			{{ item.color }}
		</td><td>
			{{ line_item.price }}			
		</td><td>
			{{ line_item.item.size }}
		</td><td>
			{{ line_item.qty_balance }}
		</td><td class="editt">
			<input type="number" value="{{ line_item.qty_balance }}" name="line-item-{{line_item.id}}" id="{{line_item.id}}" min="0" max="{{ line_item.qty_balance }}"/>			
		</td></tr>
		{% endwith %}
	{% endfor %}
	</tbody>
</table>
<button class="btn btn-primary"  type="submit">
	<i class="fa fa-save"></i>
	<span>Create a fullfillment</span>
</button>    
</form>
{% endblock %}

{% block custom_js %}
<script type="text/javascript">
var j$ = jQuery.noConflict();
j$(document).ready(function(){
	j$('.edit').editable("{%url 'so_fullfill_edit' object.id %}",{
		submit    : 'Save',
		cancel    : 'Cancel',
		onblur    : "ignore",
		//name      : "sentText",
		callback : function(value, settings) {
			console.log(value);
			console.log(settings);

		    // var json = $.parseJSON(value);
		    // $("#qty").text(json.status);
		}		
	});
});
</script>
{% endblock %}